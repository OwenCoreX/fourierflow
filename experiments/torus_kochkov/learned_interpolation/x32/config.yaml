wandb:
  project: torus_kochkov
  group: learned_interpolation/x32
  tags:
    - pde
    - navier-stokes
    - learned-interpolation
  notes: ""
builder:
  _target_: fourierflow.builders.KolmogorovBuilder
  train_dataset:
    _target_: fourierflow.builders.KolmogorovElegyDataset
    path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/full_trajectories/train_32.nc
    k: 4
    unroll_length: 10
  valid_dataset:
    _target_: fourierflow.builders.KolmogorovElegyTrajectoryDataset
    init_path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/initial_conditions/valid_32.nc
    path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/full_trajectories/valid_32.nc
    corr_path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/full_trajectories/valid_32.nc
    k: 4
    inner_steps: 8
    outer_steps: 100
  test_dataset:
    _target_: fourierflow.builders.KolmogorovElegyTrajectoryDataset
    init_path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/initial_conditions/test_32.nc
    path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/full_trajectories/test_32.nc
    corr_path: ${oc.env:DATA_ROOT}/kolmogorov/re_1000/full_trajectories/test_32.nc
    k: 4
    inner_steps: 8
    outer_steps: 100
  batch_size: 32
  num_workers: 4
  collate_fn:
    _target_: functools.partial
    _args_: ["${get_method: fourierflow.builders.collate_jax}"]
routine:
  _target_: fourierflow.routines.LearnedInterpolator
  size: 32
  dt: 0.014024967203525862
  inner_steps: 8
  outer_steps: 100
  unroll_length: 10
  physics_specs:
    _target_: jax_cfd.ml.physics_specifications.NavierStokesPhysicsSpecs
    density: 1.0
    viscosity: 1e-3
    forcing_module:
      _target_: functools.partial
      _args_: ["${get_method: jax_cfd.ml.forcings.kolmogorov_forcing}"]
      scale: 1.0
      wavenumber: 4
      linear_coefficient: -0.1
  convection_module:
    _target_: functools.partial
    _args_: ["${get_method: jax_cfd.ml.advections.self_advection}"]
    advection_module:
      _target_: functools.partial
      _args_: ["${get_method: jax_cfd.ml.advections.modular_self_advection}"]
      interpolation_module:
        _target_: functools.partial
        _args_: ["${get_method: jax_cfd.ml.interpolations.FusedLearnedInterpolation}"]
        tags: ['u', 'c']
  optimizer:
    _target_: optax.adamw
    learning_rate:
      _target_: optax.warmup_cosine_decay_schedule
      init_value: 0.0
      peak_value: 1e-3
      warmup_steps: 500
      decay_steps: 97560  # 9756 steps per epoch
      end_value: 0.0
    weight_decay: 1e-4
    b1: 0.9
    b2: 0.999
  seed: 5123
trainer:
  max_epochs: 10
  # limit_train_batches: 20
  callbacks:
    - _target_: fourierflow.callbacks.JAXModelCheckpoint
      save_dir: experiments/torus_kochkov/learned_interpolation/x32/checkpoints
